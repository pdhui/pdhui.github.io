!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.fdDev=t():e.fdDev=t()}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,exports,t){"use strict";var i=t(1),n=t(3),o=t(4),s=t(5),r=t(6),a=t(7),l={isMobile:function(){var e=navigator.userAgent;return e.indexOf("Mobile")>-1||e.indexOf("Android")>-1}(),opacitys:[1,.8,.5,.3,0],currentOpacityIdx:0,isLoad:!1,dispatchEvent:function(e,t){var i=this,o=(e.target,this.canvasWidth),s=this.canvasHeight;if("fillScreen"==t){var r=document.documentElement.clientWidth,l=this.visualImgSize.width/this.visualImgSize.height;this.coverImgStyle.width=r+"px",this.coverImgStyle.height=r/l+"px",this.caculateCanvas(),a.resizeGuideLine(o,s)}else if("remainRes"==t)n.assign(this.coverImgStyle,{width:this.visualImgSize.width+"px",height:this.visualImgSize.height+"px"}),this.caculateCanvas(),a.resizeGuideLine(o,s);else if("loadImg"==t)document.querySelector(".imgfile").click();else if("toggleShow"==t){var c=this.coverImgStyle.opacity;c>0||""===c?this.coverImgStyle.opacity=0:this.coverImgStyle.opacity=1}else if("fadeout"==t)this.currentOpacityIdx=(this.currentOpacityIdx+1)%this.opacitys.length,this.coverImgStyle.opacity=this.opacitys[this.currentOpacityIdx];else if("fadein"==t)this.currentOpacityIdx=Math.max(this.currentOpacityIdx-1,0),this.coverImgStyle.opacity=this.opacitys[this.currentOpacityIdx];else if("getColor"==t)this.createColorPanel();else if("createGuideLine"==t)a.createGuideLine();else if("deleteLastLine"==t){var h=document.querySelectorAll(".guide-line:last-child");h&&(h[0].remove(),a.linePoints.pop())}else if("deleteAllLine"==t){var d=n.toArray(document.querySelectorAll(".guide-line"));d.forEach(function(e){e.remove()}),a.linePoints=[]}else if("toggleLine"==t){var d=n.toArray(document.querySelectorAll(".guide-line"));d.forEach(function(e){i.isShowGuideLine?e.style.display="none":e.style.display="block"}),this.isShowGuideLine=!this.isShowGuideLine}else"toggleLineCoords"==t?a.toggleLineCoords():"toggleTop"==t&&(this.coverImgStyle.zIndex<9010?this.coverImgStyle.zIndex=9010:this.coverImgStyle.zIndex=0);e.stopPropagation()},loadImg:function(e){var t=this,i=new FileReader,n=e.target;i.onload=function(e){var i=e.target.result,n=new Image;n.src=i,n.onload=function(e){var i=e.target;t.visualImgSize={width:i.width,height:i.height},t.createImgCanvas(n),n.onload=null,n=null}},i.readAsDataURL(n.files[0])},createImgCanvas:function(e){var t,i=this.canvas;i||(i=document.createElement("canvas"),i.id="visualImg",document.body.appendChild(i),i.addEventListener("click",this.proxyClickCanvas,!1),this.canvas=i,this.canvasContext=i.getContext("2d"),this.coverImgStyle=i.style),t=this.canvasContext,i.width=e.width,i.height=e.height,t.drawImage(e,0,0,e.width,e.height),this.caculateCanvas()},caculateCanvas:function(){var e=this.getStyle(this.canvas);this.canvasWidth=parseInt(e.width),this.canvasHeight=parseInt(e.height)},clickCanvas:function(e){var t,i,n,o,s=e.target;this.isColorPicker&&(t=e.pageX-s.offsetLeft,i=e.pageY-s.offsetTop,o=this.getCanvasPixel(t,i),n=this.canvasContext.getImageData(o.x,o.y,1,1),this.setColorVl(n.data.slice(0,4)))},getCanvasPixel:function(e,t){return e=this.visualImgSize.width/this.getStyle(this.canvas,"width").replace("px","")*e,t=this.visualImgSize.height/this.getStyle(this.canvas,"height").replace("px","")*t,new o(e,t)},createColorPanel:function(){this.canvas.addEventListener("mousemove",this.proxyCanvasMove,!1),this.canvas.addEventListener("touchmove",this.proxyCanvasMove,!1);var e=document.querySelector("._color-panel-fd");e||(e=n.createHtmlDom('<aside class="_color-panel-fd"><ul><li><input class="rgbvl" placeholder="rgba值"></li><li><input class="hexvl" placeholder="hex值"></li><li><span class="color-tip">点击获取颜色</span><em class="colorShow"></em></li><em class="closeColorPn">+</em></aside>'),document.body.appendChild(e)),e.style.display="block",this.isColorPicker=!0},closeColorPanel:function(){document.querySelector("._color-panel-fd").style.display="none",this.canvas.removeEventListener("mousemove",this.proxyCanvasMove),this.canvas.removeEventListener("touchmove",this.proxyCanvasMove),this.isColorPicker=!1},canvasMove:function(e){var t=e.touches?e.touches[0]:e;this.fixColorPicker||this.clickCanvas(t)},setColorVl:function(e){var t=e.map(function(e){return e}),i=[];document.querySelector(".rgbvl").value="rgba("+t.join(",")+")",e.slice(0,e.length-1).forEach(function(e,t){var n;e*=1,n=e.toString(16),0==n&&(n="00"),1==n.length&&(n="0"+n),i[t]=n}),document.querySelector(".hexvl").value="#"+i.join(""),document.querySelector(".colorShow").style.background=document.querySelector(".rgbvl").value},getStyle:function(e,t){var i=getComputedStyle(e);return t?getComputedStyle(e).getPropertyValue(t):i},_mouseDown:function(e){var t=getComputedStyle(this.$drag);e=e.touches?e.touches[0]:e,this.posX=e.clientX,this.posY=e.clientY,this.startX=1*t.left.replace("px",""),this.startY=1*t.bottom.replace("px",""),this.moveX=0,this.moveY=0,this.lastX=document.body.clientWidth-30,this.lastY=-220,this.isDown=!0},_mousemove:function(e){if(this.isDown){var t,i,o=e.touches?e.touches[0]:e,s=o.clientX,r=o.clientY,a=s-this.posX,l=r-this.posY;this.moveX+=a,this.moveY-=l,this.posX=s,this.posY=r,t=this.startX+this.moveX,i=this.startY+this.moveY,t>this.lastX&&(t=this.lastX),i<this.lastY&&(i=this.lastY),n.assign(this.$drag.style,{left:t+"px",bottom:i+"px"}),this.transformContainer(),e.preventDefault()}},transformContainer:function(){var e=window.innerWidth,t=window.innerHeight,i=this.$container.getBoundingClientRect(),n=i.right-e,o=i.bottom-t,s=1;n>-15&&n<79?s=1-Math.abs(n/i.width):o>-10&&o<79&&(s=1-Math.abs(o/i.height)),s<.4&&(s=.4),this.$container.style.transform="scale("+s+")"},_mouseUp:function(e){this.isDown=!1},clickBody:function(e){var t=e.target;t.closest("#_fd_dev_")||this.cm.packUpChildMenus(),t.classList.contains("closeColorPn")&&this.closeColorPanel(),a.isCreatingLine&&a.stopGuideLine(),this.isColorPicker&&!t.closest("._color-panel-fd")&&(this.isMobile||(this.fixColorPicker?document.querySelector("._color-panel-fd .color-tip").innerText="点击获取颜色":document.querySelector("._color-panel-fd .color-tip").innerText="点击重新选取颜色"),this.fixColorPicker=!this.fixColorPicker,e.preventDefault())},init:function(){var e=document.createElement("div"),t=document.createElement("style");t.id="fddev-chrome-css",t.innerHTML=i,document.querySelector("head").appendChild(t),e.innerHTML='<dl class="tool-list"><dd><div class="tool-menu"><div class="menu-btn"></div><input type="file" class="imgfile"></div> </dd></dl>',e.id="_fd_dev_",document.body.appendChild(e),this.$container=document.querySelector(".tool-list"),this.mainContainer=e,this.isShowGuideLine=!0,a.init(this)},appendContainer:function(e){this.mainContainer.appendChild(e)},handleEvent:function(e){switch(e.type){case"mousedown":case"touchstart":this._mouseDown(e);break;case"mousemove":case"touchmove":this._mousemove(e);break;case"mouseup":case"touchend":this._mouseUp(e)}},bindEvent:function(){var e=document.querySelector(".tool-list");this.proxyLoadImg=this.loadImg.bind(this),this.proxyClickBody=this.clickBody.bind(this),this.proxyClickCanvas=this.clickCanvas.bind(this),this.proxyCanvasMove=this.canvasMove.bind(this),e.addEventListener("mousedown",this,!1),e.addEventListener("mousemove",this,!1),e.addEventListener("mouseup",this,!1),e.addEventListener("touchstart",this,!1),e.addEventListener("touchmove",this,!1),e.addEventListener("touchend",this,!1),document.body.addEventListener("click",this.proxyClickBody,!1),document.querySelector(".imgfile").addEventListener("change",this.proxyLoadImg,!1),this.$drag=e},destroy:function(){var e=this.$drag;e.removeEventListener("mousedown",this),e.removeEventListener("mousemove",this),e.removeEventListener("mouseup",this),e.removeEventListener("touchstart",this),e.removeEventListener("touchmove",this),e.removeEventListener("touchend",this),document.body.removeEventListener("click",this.proxyClickBody),this.canvas&&(this.canvas.removeEventListener("mousemove",this.proxyCanvasMove),this.canvas.removeEventListener("touchmove",this.proxyCanvasMove),this.canvas.removeEventListener("click",this.proxyClickCanvas),this.canvas.remove(),this.canvas=null),document.querySelector("#_fd_dev_")&&(this.cm.destroy(),document.querySelector(".imgfile").removeEventListener("change",this.proxyLoadImg),document.querySelector("#_fd_dev_").remove(),document.querySelector("#fddev-chrome-css").remove()),this.isLoad=!1,localStorage.removeItem("_fd_dev_")},start:function(){this.init(),this.bindEvent(),this.cm=new r(document.querySelector(".menu-btn"),s(this)),this.cm.toggleMenu(),this.isLoad=!0}};if(chrome.extension){chrome.extension.onRequest.addListener(function(e,t,i){var n,o;"toggleOpen"==e.command?(o=!1,l.isLoad?l.destroy():(l.start(),o=!0,localStorage.setItem("_fd_dev_",JSON.stringify({stu:o}))),n={status:o}):"getStatus"==e.command&&(n={status:l.isLoad}),i(n)});var c=JSON.parse(localStorage.getItem("_fd_dev_"));c&&c.stu!=l.isLoad&&(l.isLoad?l.destroy():l.start(),chrome.runtime.sendMessage(null,{command:"toggleIcon",data:{status:l.isLoad}},function(){}))}else l.start()},function(e,exports,t){exports=e.exports=t(2)(),exports.push([e.id,"#_fd_dev_ a:hover{text-decoration:none}#_fd_dev_ .tool-list{position:fixed;bottom:0;z-index:9999;width:300px;text-align:center;background:rgba(0,0,0,.2);border-radius:50%;left:36%;margin:0;margin-left:-100px}#_fd_dev_ .tool-list dd,#_fd_dev_ .tool-list dl{margin:0}#_fd_dev_ .tool-list .loadImg{position:relative}#_fd_dev_ .tool-list .imgfile{position:absolute;left:0;top:0;opacity:0;display:none}#_fd_dev_ .tool-list .options-group{display:none}#_fd_dev_ .tool-list .options-set{cursor:pointer}#_fd_dev_ .tool-list .options-set:hover .options-group{display:block}#visualImg{width:100%;background-size:contain;background-repeat:no-repeat;position:absolute;top:0;left:0}.front-cav{z-index:1000;opacity:1!important}._color-panel-fd{position:fixed;right:0;top:100px;width:156px;font-size:14px}._color-panel-fd ul{background:#f90;opacity:.7;list-style:none;text-align:right;white-space:nowrap;padding:10px 3px 10px 10px;margin:0;border-top-left-radius:10px;border-bottom-left-radius:10px}._color-panel-fd li{margin-bottom:5px}._color-panel-fd .colorShow{display:inline-block;width:30px;height:30px;margin-top:5px}._color-panel-fd .color-tip{float:left;text-align:left;font-size:12px;color:#f03}._color-panel-fd .closeColorPn{position:absolute;left:-10px;top:-10px;background:#f03;display:block;border-radius:50%;width:20px;height:20px;font-size:28px;line-height:20px;text-align:center;font-style:normal;transform:rotate(44deg);cursor:pointer}.guide-line i{position:absolute;display:block;z-index:1}.guide-line .ver-guide-line{height:100%;top:0;border-left:1px solid #ccc}.guide-line .hor-guide-line{width:100%;left:0;border-top:1px solid #ccc}.guide-line .guide-txt{position:absolute;z-index:1;background:rgba(0,0,0,.2);color:red}.guide-line .line-label em{display:inline-block;position:absolute;background:#0df388;z-index:9020}.guide-line .line-label strong{position:absolute;z-index:9020;font-weight:300;font-size:14px;background:rgba(255,0,0,.5);color:#fff}.guide-line .line-label .ver-label{width:1px}.guide-line .line-label .hor-label{height:1px}.guide-line.front-guide i,.guide-line.front-guide span,.guide-zoom{z-index:9020}.guide-zoom{position:absolute}.rc-circleMenus{width:300px;height:300px;cursor:pointer}.rc-circleMenus .menus-group{transition:transform .5s ease;transition-timing-function:cubic-bezier(.175,.885,.32,1.275)}.rc-circleMenus .menu-item{transition:transform .5s ease .5s}.rc-circleMenus .menu-item text{text-anchor:middle;dominant-baseline:middle}.triggle-btn-group{fill:#f29f3f;cursor:pointer}.triggle-btn-group .triggle-btn-txt{text-anchor:middle;dominant-baseline:middle}",""])},function(e,exports){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var i=this[t];i[2]?e.push("@media "+i[2]+"{"+i[1]+"}"):e.push(i[1])}return e.join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},o=0;o<this.length;o++){var s=this[o][0];"number"==typeof s&&(n[s]=!0)}for(o=0;o<t.length;o++){var r=t[o];"number"==typeof r[0]&&n[r[0]]||(i&&!r[2]?r[2]=i:i&&(r[2]="("+r[2]+") and ("+i+")"),e.push(r))}},e}},function(e,exports){"use strict";e.exports={assign:function(){for(var e=arguments[0],t=[].slice.call(arguments,1),i=0,n=t.length;i<n;i++){var o=t[i];for(var s in o)o.hasOwnProperty(s)&&(e[s]=o[s])}return e},angleToRadian:function(e){return e*Math.PI/180},createHtmlDom:function(){var e=document.createElement("div");return function(t){var i;return e.innerHTML=t,i=e.children[0],e.removeChild(i),i}}(),toArray:function(e){return Array.prototype.slice.call(e,0)}}},function(e,exports){"use strict";e.exports=function(e,t){this.x=e,this.y=t}},function(e,exports){"use strict";e.exports=function(e){function t(t,i){e.dispatchEvent(t,i)}return{size:300,menuList:[{value:"载入图片",id:"loadImg",click:t},{value:"设置图片大小",id:"setSize",childMenus:[{id:"fillScreen",value:"图片全屏",click:t},{id:"remainRes",value:"保持图片原比例",click:t}]},{value:"获取颜色值",id:"getColor",click:t},{value:"调整透明度",id:"opacitySet",childMenus:[{id:"toggleShow",value:"关闭/隐藏",click:t},{id:"fadeout",value:"增加透明度",click:t},{id:"fadein",value:"减少透明度",click:t},{id:"toggleTop",value:"置顶/默认",click:t}]},{value:"参考线",id:"guideLine",click:t,childMenus:[{id:"createGuideLine",value:"新建",click:t},{id:"deleteLastLine",value:"取消新建",click:t},{id:"deleteAllLine",value:"删除所有参考线",click:t},{id:"toggleLine",value:"隐藏/显示参考线",click:t},{id:"toggleLineCoords",value:"隐藏/显示坐标值",click:t}]}]}}},function(e,exports,t){"use strict";function i(){}var n=t(3),o=function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg",e);return Object.keys(t).forEach(function(e){0==e.toLowerCase().indexOf("xlink:")?i.setAttributeNS("http://www.w3.org/1999/xlink",e,t[e]):i.setAttribute(e,t[e])}),i},s=function(e,t){this.x=e,this.y=t},r=function e(t,i){this.element=t,this.options=n.assign({},e.defaults,i),this.init()};r.defaults={size:160,svgClz:"rc-circleMenus"},r.prototype={constructor:r,opened:!0,menusMap:null,events:null,init:function(){this.size=this.options.size,this.width=this.size,this.height=this.size,this.centerPoint=new s(this.width/2,this.height/2),this.events={},this.menusMap={},this.prepare()},prepare:function(){this.svg=o("svg",{version:"1.1",xlink:"http://www.w3.org/1999/xlink",preserveAspectRatio:"xMinYMin meet",viewBox:"0 0 "+this.width+" "+this.height,class:this.options.svgClz}),this.drawPizzas(.6*Math.min(this.centerPoint.x,this.centerPoint.y),this.options.menuList,{hide:!0}),this.drawCircle(),this.element.appendChild(this.svg),this.bindEvent()},drawCircle:function(){var e=this.centerPoint.x,t=this.centerPoint.y,i=Math.min(e,t)/5,n=new o("g",{class:"triggle-btn-group"}),s=new o("circle",{cx:e,cy:t,r:i}),r=new o("text",{x:e,y:t,fill:"#fff","font-size":"1.5em",class:"triggle-btn-txt"});r.innerHTML="-",n.appendChild(s),n.appendChild(r),this.svg.appendChild(n),this.triggleBtn=n,this.triggleBtnText=r},drawPizzas:function(e,t,i){var s,r,a,l,c=this,h=(this.width,this.height,this.centerPoint.x),d=this.centerPoint.y,u=0,v=0;l=this.menusMap,i=i||{};var p=i.cls||"",g=i.hide?" scale(0)":"",m=h+"px "+d+"px";r=t.length,s=360/r,this.menuGroupRotate="rotate(-"+s/2+"deg)";var f,y,x=new o("g",{class:"menus-group "+p,"transform-origin":m,style:"transform:"+this.menuGroupRotate+g});n.angleToRadian(s)>Math.PI&&(v=1);for(var L=0;L<r;L++){var C,b=t[L],w=b.childMenus,S=0;u=L*s,a=n.angleToRadian(u);var k=new o("path",{fill:"#f2753f","stroke-width":1,stroke:"#000"}),E=u+s,M=1,_=this.getCirclePoint(h,d,e,u),I=this.getCirclePoint(h,d,e,E),q="M"+h+","+d+" "+_.x+","+_.y;q+=" A"+e+","+e+" 0 "+v+" "+M+" "+I.x+","+I.y,q+="z",k.setAttribute("d",q),f=new o("a",{class:"menu-item","transform-origin":m,style:"transform: rotate(-"+s*L+"deg)","data-id":b.id}),s*L>90&&s*L<270&&(S=180),C=d-.8*e,i.isChild||(l[b.id]=b,C=d-.7*e),y=new o("text",{x:h,y:C,"font-size":"0.9em",fill:"#fff",transform:"rotate("+(s*L+s/2)+", "+h+" "+d+") rotate("+S+", "+h+" "+C+")"}),y.innerHTML=b.value,f.appendChild(k),f.appendChild(y),x.appendChild(f),w&&w.length>0&&this.addEvent("hover",b.id,function(t,i,n){c.hoverEles===n||c.opened||(c.packUpChildMenus(),c.hoverEles=n,c.drawPizzas(e/.6-5,t[0],{cls:"child-menus"+n,first:!0,isChild:!0}),document.querySelectorAll(".child-menus"+n+" .menu-item").forEach(function(e){e.style.transform="rotate(0deg)"}))},w),this.addEvent("click",b.id,b.click)}i.first?this.svg.insertBefore(x,this.svg.firstChild):this.svg.appendChild(x)},packUpChildMenus:function(){var e=this;if(this.hoverEles){var t=this.menusMap[this.hoverEles].childMenus||[];document.querySelector(".child-menus"+this.hoverEles).remove(),t.forEach(function(t){Object.keys(t).forEach(function(i){"function"==typeof t[i]&&e.removeEvent(i,t.id)})}),this.hoverEles=""}},getCirclePoint:function(e,t,i,o){var s=n.angleToRadian(o);return{x:e+i*Math.sin(s),y:t-i*Math.cos(s)}},toggleMenu:function(){var e=document.querySelectorAll(".menu-item"),t=this.timelineLite,n=document.querySelector(".menus-group");document.querySelector(".child-menus-group");if(t||(t=new i),this.opened){if(n.style.transitionDelay="0s",this.timelineLite)a.restart();else{a.to(n,{transform:this.menuGroupRotate+" scale(1)"});for(var o=0;o<e.length;o++)a.to(e[o],{transform:"rotate(0deg)"});this.timelineLite=t}this.triggleBtnText.innerHTML="+"}else n.style.transitionDelay="0.8s",a.reverse(),this.triggleBtnText.innerHTML="-";this.opened=!this.opened},dispatchMenu:function(e,t){var i,n=t.target,o=n.closest(".menu-item"),s=this.events[e];o&&s&&(i=o.getAttribute("data-id"),s.forEach(function(e){e[0]==i&&e[1]&&(e[2]?e[1](e[2],t,i):e[1](t,i))}))},destroy:function(){this.triggleBtn.removeEventListener("click",this.proxyToggleMenu),this.svg.removeEventListener("click",this.proxyClickDispatch),this.triggleBtn.removeEventListener("mouseenter",this.proxyRemoveChildMenus),document.querySelector(".menus-group").removeEventListener("mouseover",this.proxyHoverDispatch),this.events=null,this.hoverEles="",this.menusMap=null},bindEvent:function(){this.proxyToggleMenu=this.toggleMenu.bind(this),this.proxyClickDispatch=this.dispatchMenu.bind(this,"click"),this.proxyHoverDispatch=this.dispatchMenu.bind(this,"hover"),this.proxyRemoveChildMenus=this.packUpChildMenus.bind(this),this.triggleBtn.addEventListener("click",this.proxyToggleMenu,!1),this.svg.addEventListener("click",this.proxyClickDispatch,!1),this.triggleBtn.addEventListener("mouseenter",this.proxyRemoveChildMenus,!1),document.querySelector(".menus-group").addEventListener("mouseover",this.proxyHoverDispatch,!1)},addEvent:function(e,t,i){var n=Array.prototype.slice.call(arguments,3),o=this.events[e];o||(o=this.events[e]=[]),n=0==n.length?void 0:n,o.push([t,i,n])},removeEvent:function(e,t,i){var n,o=this.events[e];if(o&&0!=o.length)for(var s=0,r=o.length;s<r;s++)if(n=o[s],n[0]==t)return o.splice(s,1),n},hoverEles:""};var a={_fns:[],cache:{},id:0,to:function(e,t){var i={},o=e.style;Object.keys(t).forEach(function(e){var t=o[e];null!=t&&(i[e]=t)}),e.tweenId=++this.id,this.cache[e.tweenId]=i,this._fns.push([e,function(){n.assign(o,t)}]),requestAnimationFrame(this._fns[this._fns.length-1][1])},restart:function(){var e=this;this._fns.forEach(function(t){var i=t[0],o=e.cache[i.tweenId];n.assign(i.style,o),requestAnimationFrame(t[1])})},reverse:function(){for(var e,t=this._fns.length;t--;)e=this._fns[t],requestAnimationFrame(function(e){var t=e[0],i=this.cache[t.tweenId];n.assign(t.style,i)}.bind(this,e))}};e.exports=r},function(e,exports,t){"use strict";var i=t(3),n=t(4);e.exports={isCreatingLine:!1,isShowCoords:!0,activedLine:null,linePoints:[],init:function(e){this.context=e,this.proxyLineMove=this.guideLineMove.bind(this)},createGuideLine:function(){if(!this.isCreatingLine){var e=i.createHtmlDom('<div class="guide-line front-guide"><i class="ver-guide-line"></i><i class="hor-guide-line"></i><span class="guide-txt"></span></div>');e.querySelector(".ver-guide-line").style.height=this.context.canvasHeight,e.querySelector(".hor-guide-line").style.width=this.context.canvasWidth,this.context.appendContainer(e),document.body.addEventListener("mousemove",this.proxyLineMove,!1),document.body.addEventListener("touchmove",this.proxyLineMove,!1),document.body.addEventListener("keydown",this.proxyLineMove,!1),this.isCreatingLine=!0,this.activedLine=e,this.context.canvas&&(this.createZoom(),this.context.canvas.classList.add("front-cav"))}},createZoom:function(){var e=i.createHtmlDom('<canvas class="guide-zoom"></canvas>');e.width=50,e.height=50,this.context.appendContainer(e),this.guideZoomCanvas=e,this.guideZoomCtx=e.getContext("2d")},createLineLabel:function(e,t){var n=i.createHtmlDom('<div class="line-label"><em class="ver-label"></em><em class="hor-label"></em><strong class="ver-h"></strong><strong class="hor-w"></strong></div>'),o=t.x-e.x,s=t.y-e.y,r=Math.abs(s);i.assign(n.querySelector(".hor-label").style,{left:(o>0?e.x:e.x+o)+"px",top:t.y+"px",width:Math.abs(o)+"px"}),i.assign(n.querySelector(".ver-label").style,{left:t.x+"px",top:(s>0?e.y:e.y+s)+"px",height:r+"px"}),i.assign(n.querySelector(".hor-w").style,{left:(o>0?e.x:e.x+o)+"px",top:t.y+"px"}),n.querySelector(".hor-w").innerText=Math.abs(o.toFixed(2)),i.assign(n.querySelector(".ver-h").style,{left:t.x-15+"px",top:(s>0?e.y:e.y+s)+(r-16)/2+"px"}),n.querySelector(".ver-h").innerText=r.toFixed(2),this.activedLine.appendChild(n)},guideLineMove:function(e){var t,n=e.touches?e.touches[0]:e,o=n.pageX,s=n.pageY,r=this.lastPageX,a=this.lastPageY,l=this.activedLine;if("keydown"==e.type){var c=e.keyCode;if(o=1*l.querySelector(".ver-guide-line").style.left.replace("px",""),s=1*l.querySelector(".hor-guide-line").style.top.replace("px",""),"40"==c)s+=1;else if("38"==c)s-=1;else if("37"==c)o-=1;else if("39"==c)o+=1;else{if(13==c)return void this.stopGuideLine();if(27==c)return void this.remove(!0)}}else if(this.lastPageX=o,this.lastPageY=s,r==o&&a==s)return;i.assign(l.querySelector(".ver-guide-line").style,{left:o+"px"}),i.assign(l.querySelector(".hor-guide-line").style,{top:s+"px"}),t=l.querySelector(".guide-txt"),i.assign(t.style,{left:o+10+"px",top:s+10+"px"}),t.innerText="("+o+","+s+")",this.zoomIn(o,s),e.preventDefault()},stopGuideLine:function(){var e,t,o,s,r=this.activedLine.querySelector(".guide-txt");e=1*r.style.left.replace("px","")-10,t=1*r.style.top.replace("px","")-10,i.assign(r.style,{left:e+"px",top:t+"px"}),this.isCreatingLine=!1,o=new n(e,t),this.linePoints.length>0&&(s=this.linePoints[this.linePoints.length-1],this.linePoints.length%2!=0&&this.createLineLabel(s,o)),this.linePoints.push(o),this.remove(!1)},zoomIn:function(e,t){if(this.guideZoomCtx){var o=this.context.getCanvasPixel(e,t);this.guideZoomCtx.drawImage(this.context.canvas,o.x-10,o.y-10,20,20,0,0,50,50),this.drawLine(new n(25,0),new n(25,50)),this.drawLine(new n(0,25),new n(50,25)),i.assign(this.guideZoomCanvas.style,{left:e+10+"px",top:t+30+"px"})}},drawLine:function(e,t){var i=this.guideZoomCtx;i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.stroke()},resizeGuideLine:function(e,t){var n,o=this,s=i.toArray(document.querySelectorAll(".guide-line")),r=this.context.canvasWidth,a=this.context.canvasHeight;this.linePoints.forEach(function(i){i.x=1*(i.x*r/e).toFixed(2),i.y=1*(i.y*a/t).toFixed(2)}),s.forEach(function(e,t){var s=o.linePoints[t],l=e.querySelector(".guide-txt");i.assign(e.querySelector(".ver-guide-line").style,{height:a+"px",left:s.x+"px"}),i.assign(e.querySelector(".hor-guide-line").style,{width:r+"px",top:s.y+"px"}),i.assign(l.style,{left:s.x+"px",top:s.y+"px"}),l.textContent="("+s.x+","+s.y+")",n&&e.querySelector(".line-label")&&(e.querySelector(".line-label").remove(),o.createLineLabel(n,s)),n=s})},toggleLineCoords:function(){var e=this;i.toArray(document.querySelectorAll(".guide-line .guide-txt")).forEach(function(t){e.isShowCoords?t.style.display="none":t.style.display="block"}),this.isShowCoords=!this.isShowCoords},remove:function(e){document.body.removeEventListener("mousemove",this.proxyLineMove),document.body.removeEventListener("touchmove",this.proxyLineMove),document.body.removeEventListener("keydown",this.proxyLineMove),this.context.canvas&&(this.guideZoomCanvas.remove(),this.guideZoomCtx=null,this.guideZoomCanvas=null,this.context.canvas.classList.remove("front-cav")),e&&(this.activedLine.remove(),this.activedLine=null)}}}])});